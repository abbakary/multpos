{% extends 'tracker/base.html' %} {% load static custom_filters tz %} {% load date_filters %} {% block title %}Order Details{% endblock %} {% block content %} <div class="container-fluid"> <div class="page-title"> <div class="row"> <div class="col-6"><h4>Order {{ order.order_number }}</h4></div> <div class="col-6"> <ol class="breadcrumb"> <li class="breadcrumb-item"><a href="{% url 'tracker:orders_list' %}">Orders</a></li> <li class="breadcrumb-item active">Details</li> </ol> </div> </div> </div> </div> <div class="container-fluid"> <div class="row g-3"> <div class="col-xl-8"> <div class="card"><div class="card-header"><h5 class="mb-0">Order Info</h5></div> <div class="card-body"> <div class="row g-3"> <div class="col-md-6"><div class="f-light">Type</div><div class="f-w-600 text-capitalize">{{ order.type }}</div></div> <div class="col-md-6"><div class="f-light">Status</div><div class="f-w-600 text-capitalize">{{ order.status }}</div></div> <div class="col-md-6"><div class="f-light">Priority</div><div class="f-w-600 text-capitalize">{{ order.priority }}</div></div> <div class="col-md-6"> <div class="f-light">created</div> <div class="f-w-600"> {{ order.created_at|custom_date }} </div> </div> <div class="col-md-6"> <div class="f-light">Updated</div> <div class="f-w-600"> {{ order|order_last_update|custom_date }} </div> </div> {% if order.started_at %} <div class="col-md-6"> <div class="f-light">Started</div> <div class="f-w-600"> {{ order.started_at|custom_date }} </div> </div> {% endif %} {% if order.completed_at %} <div class="col-md-6"> <div class="f-light">Completed</div> <div class="f-w-600"> {{ order.completed_at|custom_date }} </div> </div> {% endif %} {% if order.status == 'completed' %} <div class="col-12"> <hr> <div class="row g-3 align-items-start"> <div class="col-md-6"> <div class="f-light">Signed By</div> <div class="f-w-600">{{ order.signed_by|default:'-' }}</div> </div> <div class="col-md-6"> <div class="f-light">Signed At</div> <div class="f-w-600">{{ order.signed_at|custom_date }}</div> </div> {% if order.signature_file %} <div class="col-md-6"> <div class="f-light">Signature</div> <div> <img src="{{ order.signature_file.url }}" alt="Signature" class="img-fluid border rounded" style="max-height:140px"> </div> </div> {% endif %} {% if order.completion_attachment %} <div class="col-md-6"> <div class="f-light">Attachment</div> <div> <a href="{{ order.completion_attachment.url }}" target="_blank" class="btn btn-outline-primary btn-sm"> <i class="fa fa-download me-1"></i> View/Download </a> </div> </div> {% endif %} </div> </div> {% endif %} {% if order.status == 'cancelled' %} <div class="col-12"> <hr> <div class="card border-danger"> <div class="card-header bg-danger text-white py-2"> <h6 class="mb-0"><i class="fa fa-ban me-2"></i>Order Cancelled</h6> </div> <div class="card-body"> <div class="f-light">Cancellation Date</div> <div class="f-w-600 mb-3">{{ order.cancelled_at|custom_date }}</div> <div class="f-light">Reason for Cancellation</div> <div class="f-w-600 text-danger">{{ order.cancellation_reason|default:'No reason provided' }}</div> </div> </div> </div> {% endif %} </div> <hr> {% if order.type == 'service' %} <div class="card border-primary mb-3"> <div class="card-header bg-primary text-white py-2"> <h6 class="mb-0"><i class="fa fa-tools me-2"></i>Service Details</h6> </div> <div class="card-body"> <div class="mb-3"> <div class="d-flex align-items-center mb-1"> <i class="fa fa-info-circle text-primary me-2"></i> <h6 class="mb-0 fw-bold">Service Description</h6> </div> <div class="ps-3 ms-3 border-start border-2 border-primary"> {{ order.description|default:'No description provided'|linebreaks }} </div> </div> <div class="d-flex align-items-center"> <div class="d-flex align-items-center me-4"> <i class="fa fa-clock text-primary me-2"></i> <div> <div class="text-muted small">Estimated Duration</div> <div class="fw-bold">{{ order.estimated_duration|default:'-' }} minutes</div> </div> </div> {% if order.status == 'completed' %} <div class="d-flex align-items-center"> <i class="fa fa-check-circle text-success me-2"></i> <div> <div class="text-muted small">Actual Duration</div> <div class="fw-bold"> {% if order.actual_duration %} {{ order.actual_duration }} minutes {% else %} Not recorded {% endif %} </div> </div> </div> {% endif %} </div> </div> </div> {% elif order.type == 'sales' %} <div class="card border-warning mb-3"> <div class="card-header bg-warning text-dark py-2"> <h6 class="mb-0"><i class="fa fa-shopping-cart me-2"></i>Sales Details</h6> </div> <div class="card-body"> <div class="row g-3"> <div class="col-md-6"><div class="f-light">Item</div><div class="f-w-600">{{ order.item_name|default:'-' }}</div></div> <div class="col-md-6"><div class="f-light">Brand</div><div class="f-w-600">{{ order.brand|default:'-' }}</div></div> <div class="col-md-6"><div class="f-light">Quantity</div><div class="f-w-600">{{ order.quantity|default:'-' }}</div></div> <div class="col-md-6"><div class="f-light">Tire Type</div><div class="f-w-600">{{ order.tire_type|default:'-' }}</div></div> </div> {% if order.description %} <div class="mt-3"> <div class="d-flex align-items-center mb-1"> <i class="fa fa-info-circle text-warning me-2"></i> <h6 class="mb-0 fw-bold">Description</h6> </div> <div class="ps-3 ms-3 border-start border-2 border-warning"> {{ order.description|linebreaksbr }} </div> </div> {% endif %} </div> </div> {% else %} <div class="card border-info mb-3"> <div class="card-header bg-info text-white py-2"> <h6 class="mb-0"><i class="fa fa-question-circle me-2"></i>Inquiries Details</h6> </div> <div class="card-body"> <div class="row g-3"> <div class="col-md-6"><div class="f-light">Inquiry Type</div><div class="f-w-600">{{ order.inquiry_type|default:'General' }}</div></div> <div class="col-md-6"><div class="f-light">Contact</div><div class="f-w-600 text-capitalize">{{ order.contact_preference|default:'phone' }}</div></div> <div class="col-12"><div class="f-light">Questions</div><div>{{ order.questions|linebreaksbr }}</div></div> {% if order.follow_up_date %}<div class="col-md-6"><div class="f-light">Follow up</div><div class="f-w-600">{{ order.follow_up_date }}</div></div>{% endif %} </div> {% if order.description %} <div class="mt-3"> <div class="d-flex align-items-center mb-1"> <i class="fa fa-info-circle text-info me-2"></i> <h6 class="mb-0 fw-bold">Description</h6> </div> <div class="ps-3 ms-3 border-start border-2 border-info"> {{ order.description|linebreaksbr }} </div> </div> {% endif %} </div> </div> {% endif %} </div> </div> </div> <div class="col-xl-4"> <div class="card"><div class="card-header"><h5 class="mb-0">Customer</h5></div> <div class="card-body"> <div class="mb-2 f-w-600"><a href="{% url 'tracker:customer_detail' order.customer.id %}">{{ order.customer.full_name }}</a></div> <div class="f-light">Phone</div><div class="mb-2">{{ order.customer.phone }}</div> <div class="f-light">Email</div><div class="mb-2">{{ order.customer.email|default:'-' }}</div> <div class="f-light">Type</div><div class="mb-2"><span class="badge bg-secondary">{{ order.customer.get_customer_type_display|default:"Personal" }}</span></div> {% if order.customer.organization_name %} <div class="f-light">Organization</div><div class="mb-2">{{ order.customer.organization_name }}</div> {% endif %} {% if order.customer.personal_subtype %} <div class="f-light">Personal Type</div><div class="mb-2">{{ order.customer.get_personal_subtype_display }}</div> {% endif %} </div> </div> <div class="card"><div class="card-header"><h5 class="mb-0">Vehicle</h5></div> <div class="card-body"> {% if order.vehicle %} <div class="d-flex align-items-center mb-2"> <i class="fa fa-car text-primary me-2"></i> <strong>{{ order.vehicle.plate_number|default:'No plate number' }}</strong> </div> {% if order.vehicle.make or order.vehicle.model %} <div class="mb-1"> <span class="f-light">Make & Model:</span> <span class="f-w-600">{{ order.vehicle.make|default:'' }} {{ order.vehicle.model|default:'' }}</span> </div> {% endif %} {% if order.vehicle.vehicle_type %} <div class="mb-1"> <span class="f-light">Type:</span> <span class="f-w-600 text-capitalize">{{ order.vehicle.vehicle_type }}</span> </div> {% endif %} {% else %} <div class="text-muted">No vehicle information</div> {% endif %} </div> </div> <div class="card"><div class="card-header"><h5 class="mb-0">Actions</h5></div> <div class="card-body"> <div class="vstack gap-3"> {% if order.status == 'created' %} <form method="post" action="{% url 'tracker:update_order_status' order.id %}"> {% csrf_token %} <input type="hidden" name="status" value="in_progress"> </form> {% endif %} {% if order.status != 'completed' and order.status != 'cancelled' %} <form method="post" action="{% url 'tracker:complete_order' order.id %}" enctype="multipart/form-data" class="border rounded p-2"> {% csrf_token %} <div class="mb-2">  <input type="password" class="form-control" name="password" placeholder="Enter your account password" > </div> <div class="row g-2"> <div class="col-12"> <label class="form-label">Signature Image</label> <input type="file" accept="image/*" name="signature_file" class="form-control"> </div> <div class="col-12"> <label class="form-label">Completion File </label> <input type="file" name="completion_attachment" class="form-control"> </div> </div> <small class="text-muted d-block mb-2">Upload at least one: signature image or completion file.</small> <button class="btn btn-success w-100" type="submit"><i class="fa fa-check me-1"></i> Mark as Completed</button> </form> <form method="post" action="{% url 'tracker:cancel_order' order.id %}" class="border border-danger rounded p-3" onsubmit="return confirm('Are you sure you want to cancel this order? This action cannot be undone.')"> {% csrf_token %} <div class="mb-2"> <label class="form-label text-danger fw-bold">Cancellation Reason <span class="text-danger">*</span></label> <textarea class="form-control" name="reason" rows="3" placeholder="Please provide a detailed reason for cancelling this order..." required minlength="10"></textarea> <small class="text-muted">Minimum 10 characters required. This reason will be permanently recorded.</small> </div> <button class="btn btn-danger w-100 mt-2" type="submit"><i class="fa fa-ban me-1"></i> Cancel Order</button> </form> {% endif %} {% if order.status == 'completed' %} <div class="alert alert-success mb-0"><i class="fa fa-check-circle me-1"></i> This order is completed.</div> {% elif order.status == 'cancelled' %} <div class="alert alert-danger mb-0"><i class="fa fa-ban me-1"></i> This order is cancelled.</div> {% endif %} </div> </div> </div> </div> </div> </div> {% endblock %} 
